{"version":3,"sources":["../../../../app/_lib/storage.ts","../../../../app/_actions/preferences.ts","../../../../.next-internal/server/app/app/preferences/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { promises as fs } from 'fs';\nimport path from 'path';\n\nfunction getDataDir() {\n  return process.env.MP_DATA_DIR ?? path.join(process.cwd(), 'data');\n}\n\nasync function ensureDir() {\n  await fs.mkdir(getDataDir(), { recursive: true });\n}\n\nasync function ensureFile<T>(fileName: string, fallback: T) {\n  await ensureDir();\n  const filePath = path.join(getDataDir(), fileName);\n  try {\n    await fs.access(filePath);\n  } catch {\n    await fs.writeFile(filePath, JSON.stringify(fallback, null, 2), 'utf-8');\n  }\n  return filePath;\n}\n\nexport async function readStore<T>(fileName: string, fallback: T): Promise<T> {\n  const filePath = await ensureFile(fileName, fallback);\n  const raw = await fs.readFile(filePath, 'utf-8');\n  return JSON.parse(raw) as T;\n}\n\nexport async function writeStore<T>(fileName: string, data: T) {\n  const filePath = await ensureFile(fileName, data);\n  await fs.writeFile(filePath, JSON.stringify(data, null, 2), 'utf-8');\n}\n","'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { readStore, writeStore } from '../_lib/storage';\nimport type { Preferences } from '../_lib/types';\n\nconst storeFile = 'preferences.json';\n\nconst fallback: Preferences = {\n  theme: 'system',\n  currency: 'USD',\n  notifications: { email: true, inApp: true },\n};\n\nexport async function updatePreferences(formData: FormData) {\n  const theme = String(formData.get('theme') ?? 'system') as Preferences['theme'];\n  const currency = String(formData.get('currency') ?? 'USD') as Preferences['currency'];\n  const email = Boolean(formData.get('email'));\n  const inApp = Boolean(formData.get('inApp'));\n\n  const store = await readStore<Preferences>(storeFile, fallback);\n  const next = {\n    ...store,\n    theme,\n    currency,\n    notifications: {\n      email,\n      inApp,\n    },\n  } satisfies Preferences;\n\n  await writeStore(storeFile, next);\n  revalidatePath('/app/preferences');\n  revalidatePath('/app');\n}\n","export {updatePreferences as '401a08fc8f4497a5b211d4f0010161759efd0a6d5f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"8FAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,SAAS,IACP,OAAO,QAAQ,GAAG,CAAC,WAAW,EAAI,EAAA,OAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAI,OAC7D,CAEA,eAAe,IACb,MAAM,EAAA,QAAE,CAAC,KAAK,CAAC,IAAc,CAAE,UAAW,EAAK,EACjD,CAEA,eAAe,EAAc,CAAgB,CAAE,CAAW,EACxD,MAAM,IACN,IAAM,EAAW,EAAA,OAAI,CAAC,IAAI,CAAC,IAAc,GACzC,GAAI,CACF,MAAM,EAAA,QAAE,CAAC,MAAM,CAAC,EAClB,CAAE,KAAM,CACN,MAAM,EAAA,QAAE,CAAC,SAAS,CAAC,EAAU,KAAK,SAAS,CAAC,EAAU,KAAM,GAAI,QAClE,CACA,OAAO,CACT,CAEO,eAAe,EAAa,CAAgB,CAAE,CAAW,EAC9D,IAAM,EAAW,MAAM,EAAW,EAAU,GAE5C,OAAO,KAAK,KAAK,CAAC,AADN,MAAM,EAAA,QAAE,CAAC,QAAQ,CAAC,EAAU,SAE1C,CAEO,eAAe,EAAc,CAAgB,CAAE,CAAO,EAC3D,IAAM,EAAW,MAAM,EAAW,EAAU,EAC5C,OAAM,EAAA,QAAE,CAAC,SAAS,CAAC,EAAU,KAAK,SAAS,CAAC,EAAM,KAAM,GAAI,QAC9D,sFC7BA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,oBAGA,IAAM,EAAY,mBAEZ,EAAwB,CAC5B,MAAO,SACP,SAAU,MACV,cAAe,CAAE,OAAO,EAAM,OAAO,CAAK,CAC5C,EAEO,eAAe,EAAkB,CAAkB,EACxD,IAAM,EAAQ,OAAO,EAAS,GAAG,CAAC,UAAY,UACxC,EAAW,OAAO,EAAS,GAAG,CAAC,aAAe,OAC9C,GAAQ,CAAQ,EAAS,GAAG,CAAC,SAC7B,GAAQ,CAAQ,EAAS,GAAG,CAAC,SAG7B,EAAO,CADyC,GAAxC,MAAM,CAAA,EAAA,EAAA,SAAA,AAAS,EAAc,EAAW,EAEpD,GAAG,IACH,CADQ,UAER,EACA,cAAe,OACb,QACA,CACF,CACF,CAEA,OAAM,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAW,GAC5B,CAAA,EAAA,EAAA,cAAc,AAAd,EAAe,oBACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,OACjB,iCApBsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,+DCdtB,IAAA,EAAA,EAAA,CAAA,CAAA"}