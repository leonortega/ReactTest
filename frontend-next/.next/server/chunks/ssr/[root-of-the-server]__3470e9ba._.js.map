{"version":3,"sources":["../../../../app/_lib/storage.ts","../../../../app/_lib/ids.ts","../../../../app/_actions/alerts.ts","../../../../.next-internal/server/app/app/alerts/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { promises as fs } from 'fs';\nimport path from 'path';\n\nfunction getDataDir() {\n  return process.env.MP_DATA_DIR ?? path.join(process.cwd(), 'data');\n}\n\nasync function ensureDir() {\n  await fs.mkdir(getDataDir(), { recursive: true });\n}\n\nasync function ensureFile<T>(fileName: string, fallback: T) {\n  await ensureDir();\n  const filePath = path.join(getDataDir(), fileName);\n  try {\n    await fs.access(filePath);\n  } catch {\n    await fs.writeFile(filePath, JSON.stringify(fallback, null, 2), 'utf-8');\n  }\n  return filePath;\n}\n\nexport async function readStore<T>(fileName: string, fallback: T): Promise<T> {\n  const filePath = await ensureFile(fileName, fallback);\n  const raw = await fs.readFile(filePath, 'utf-8');\n  return JSON.parse(raw) as T;\n}\n\nexport async function writeStore<T>(fileName: string, data: T) {\n  const filePath = await ensureFile(fileName, data);\n  await fs.writeFile(filePath, JSON.stringify(data, null, 2), 'utf-8');\n}\n","export function createId() {\n  if (typeof crypto !== 'undefined' && 'randomUUID' in crypto) {\n    return crypto.randomUUID();\n  }\n  return `${Date.now()}-${Math.random().toString(16).slice(2)}`;\n}\n","'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { createId } from '../_lib/ids';\nimport { readStore, writeStore } from '../_lib/storage';\nimport type { Alert, AlertJob, Notification } from '../_lib/types';\n\nconst alertsFile = 'alerts.json';\nconst notificationsFile = 'notifications.json';\nconst jobsFile = 'jobs.json';\n\nexport async function createAlert(formData: FormData) {\n  const symbol = String(formData.get('symbol') ?? '')\n    .trim()\n    .toUpperCase();\n  const threshold = Number(formData.get('threshold'));\n  const direction = String(formData.get('direction') ?? 'above') as Alert['direction'];\n  const schedule = String(formData.get('schedule') ?? 'realtime') as Alert['schedule'];\n\n  if (!symbol || Number.isNaN(threshold)) {\n    return;\n  }\n\n  const alertsStore = await readStore<{ items: Alert[] }>(alertsFile, { items: [] });\n  const alert: Alert = {\n    id: createId(),\n    symbol,\n    threshold,\n    direction,\n    schedule,\n    status: 'active',\n    createdAt: new Date().toISOString(),\n  };\n\n  alertsStore.items.unshift(alert);\n  await writeStore(alertsFile, alertsStore);\n\n  const notificationsStore = await readStore<{ items: Notification[] }>(notificationsFile, {\n    items: [],\n  });\n  const message = `Alert set for ${symbol} ${direction} ${threshold}.`;\n  notificationsStore.items.unshift(\n    {\n      id: createId(),\n      alertId: alert.id,\n      channel: 'in-app',\n      message,\n      createdAt: new Date().toISOString(),\n      read: false,\n    },\n    {\n      id: createId(),\n      alertId: alert.id,\n      channel: 'email',\n      message,\n      createdAt: new Date().toISOString(),\n      read: false,\n    },\n  );\n  await writeStore(notificationsFile, notificationsStore);\n\n  const jobsStore = await readStore<{ items: AlertJob[] }>(jobsFile, { items: [] });\n  jobsStore.items.unshift({\n    id: createId(),\n    alertId: alert.id,\n    runAt: new Date(Date.now() + 60_000).toISOString(),\n    status: 'queued',\n  });\n  await writeStore(jobsFile, jobsStore);\n\n  revalidatePath('/app/alerts');\n  revalidatePath('/app/alerts/history');\n  revalidatePath('/app');\n}\n","export {createAlert as '401a1a817d761cb861770a4b502a29efd1d23475e7'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}